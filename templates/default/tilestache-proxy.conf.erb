<VirtualHost *:80>
  ServerName <%= @params[:server_name] %>
  ProxyRequests off
  ProxyPass <%= @params[:base_uri] %> http://<%= node[:ipaddress] %>:<%= @params[:proxy_port] %>/ max=<%= @params[:max] %> ttl=<%= @params[:ttl] %> retry=<%= @params[:retrytimeout] %> connectiontimeout=<%= @params[:connectiontimeout] %> timeout=30
  LogFormat "%v:%p %h %l %u %t \"%r\" %>s %O \"%{Referer}i\" \"%{User-Agent}i\"" tilestache_combined
  CustomLog ${APACHE_LOG_DIR}/tilestache_access.log tilestache_combined

  <Location <%= @params[:base_uri] %>>
    Header set Access-Control-Allow-Origin "*"
    SetOutputFilter DEFLATE
    Header set Cache-Control "max-age=<%= @params[:max_age] %>"
    Order allow,deny
    Allow from all
  </Location>

<% if @params[:canvas_map] == true -%>
  AliasMatch ^/$ /var/www/index.html
  AliasMatch ^/vector$ /var/www/index.html
  <Directory /var/www>
    Options Indexes
  </Directory>
<% end -%>
</VirtualHost>

